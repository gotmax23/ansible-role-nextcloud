---
# vars file for nextcloud

_nextcloud_requirements:
  default:
    - php-gd
    - php-intl
    - php-json
    - php-mbstring
    - php-mysqlnd
    - php-pecl-apcu
    - php-pecl-redis
    - php-process
    - php-zip
  Alpine:
    - php-process
    - php7-gd
    - php7-intl
    - php7-json
    - php7-mbstring
    - php7-mysqlnd
    - php7-zip
  RedHat:
    - php-gd
    - php-imagick
    - php-intl
    - php-json
    - php-mbstring
    - php-mysqlnd
    - php-opcache
    - php-pecl-apcu
    - php-process
    - php-redis
    - php-zip
  Debian:
    - php-gd
    - php-intl
    - php-mbstring
    - php-mysql
    - php-posix
    - php-zip
  Suse:
    - php-process
    - php7-gd
    - php7-intl
    - php7-json
    - php7-mbstring
    - php7-mysql
    - php7-zip

nextcloud_requirements: "{{ _nextcloud_requirements[ansible_os_family] | default(_nextcloud_requirements['default']) }}"

nextcloud_sebooleans:
  - httpd_can_network_connect
  - httpd_unified

_nextcloud_httpd_owner:
  default: apache
  Debian: www-data
  Suse: wwwrun

nextcloud_httpd_owner: "{{ _nextcloud_httpd_owner[ansible_os_family] | default(_nextcloud_httpd_owner['default']) }}"

_nextcloud_httpd_group:
  default: apache
  Debian: www-data
  Suse: www

nextcloud_httpd_group: "{{ _nextcloud_httpd_group[ansible_os_family] | default(_nextcloud_httpd_group['default']) }}"

nextcloud_archive: "https://download.nextcloud.com/server/releases/nextcloud-{{ nextcloud_version }}.zip"

_nextcloud_destination:
  default: /var/www/html
  Alpine: /var/www
  openSUSE Leap: /srv/www/htdocs

nextcloud_destination: "{{ _nextcloud_destination[ansible_distribution] | default(_nextcloud_destination['default']) }}"

_nextcloud_config_directory:
  default: /etc/httpd/conf.d
  Alpine: /etc/apache2/conf.d
  Debian: /etc/apache2/conf-enabled
  Suse: /etc/apache2/conf.d

nextcloud_config_directory: "{{ _nextcloud_config_directory[ansible_os_family] | default(_nextcloud_config_directory['default']) }}"

nextcloud_packages:
  - nextcloud-files

nextcloud_permissions:
  - name: "{{ nextcloud_destination }}/nextcloud/config/config.php"
    mode: "0660"
  - name: "{{ nextcloud_destination }}/nextcloud/apps"
    mode: "0770"
  - name: "{{ nextcloud_destination }}/nextcloud/data"
    owner: "{{ nextcloud_httpd_owner }}"
    group: "{{ nextcloud_httpd_group }}"
    mode: "0770"
    state: directory

nextcloud_command: php occ maintenance:install --database "mysql" --database-name "{{ nextcloud_database_name }}" --database-user "{{ nextcloud_database_user }}" --database-pass "{{ nextcloud_database_pass }}" --database-host "{{ nextcloud_database_host }}" --admin-user "{{ nextcloud_admin_user }}" --admin-pass "{{ nextcloud_admin_pass }}"
